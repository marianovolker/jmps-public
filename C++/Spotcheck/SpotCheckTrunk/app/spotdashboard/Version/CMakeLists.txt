# CMakeLists.txt for Version
aux_source_directory(${CMAKE_CURRENT_SOURCE_DIR} VERSION_SRC)

function(writeBuildInfoFile BUILD_NUMBER_STRING)
	file(WRITE ${CMAKE_CURRENT_BINARY_DIR}/buildinfo.temp "\n"
		"//*************** PLEASE DO NOT EDIT *****************\n"
		"//This file automatically generated by the build script\n"
		"#include \"Version/buildinfo.h\""
		"\n\n"
		"const char gBuildNumber[] =  \"${BUILD_NUMBER_STRING}\";\n")
		
	configure_file (${CMAKE_CURRENT_BINARY_DIR}/buildinfo.temp 
	${CMAKE_CURRENT_BINARY_DIR}/buildinfo.cpp)
endfunction()

#Automatically generate build information
if(${GENERATE_BUILD_INFO})
	include(FindSubversion)
	message("Running svn info on source dir folder: " ${CMAKE_SOURCE_DIR})
	Subversion_WC_INFO(${CMAKE_SOURCE_DIR} SPOTCHECK)
	writeBuildInfoFile(${SPOTCHECK_WC_REVISION})
else() #For any build that was not requested through the valid build process stamp it with debug label
	writeBuildInfoFile("000 - THIS IS A DEVELOPMENT DEBUG BUILD - 000")
endif()	

add_library(Version_Dashboard
	${CMAKE_CURRENT_BINARY_DIR}/buildinfo.cpp
	${VERSION_SRC}
)

add_clean_target(Version_Dashboard)
